<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>College Debt Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 2rem;
      text-align: center;
    }
    svg {
      background-color: white;
      border: 1px solid #ccc;
      margin-top: 1rem;
    }
    #filters {
      margin-top: 1rem;
    }
    select, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>College Debt in America</h1>
  <div id="viz"></div>

  <div id="filters" style="display: none;">
    <label for="majorFilter">Filter by Major:</label>
    <select id="majorFilter"></select>
  </div>

  <div id="controls">
    <button id="next">Next</button>
    <button id="reset" style="display:none;">Restart</button>
  </div>

  <script>
    let currentScene = 0;
    const container = d3.select("#viz");

    const allData = [
      { major: "Engineering", debt: 25000, income: 70000 },
      { major: "Social Work", debt: 35000, income: 35000 },
      { major: "Business", debt: 30000, income: 60000 },
      { major: "Art", debt: 28000, income: 32000 },
      { major: "Education", debt: 32000, income: 40000 }
    ];

    function clearScene() {
      container.html("");
    }

    function renderScene0() {
      clearScene();
      d3.select("#filters").style("display", "none");
      const svg = container.append("svg")
        .attr("width", 600)
        .attr("height", 300);

      svg.append("text")
        .attr("x", 300)
        .attr("y", 150)
        .attr("text-anchor", "middle")
        .attr("font-size", "36px")
        .attr("fill", "darkred")
        .text("$1.7 Trillion in Student Debt");
    }

    function renderScene4(selectedMajor = "All") {
      d3.select("#filters").style("display", "block");
      container.select("svg").remove(); // FIX: Only remove existing SVG, not the whole container

      const svg = container.append("svg")
        .attr("width", 600)
        .attr("height", 300);

      const filtered = selectedMajor === "All"
        ? allData
        : allData.filter(d => d.major === selectedMajor);

      if (filtered.length === 0) {
        svg.append("text")
          .attr("x", 300)
          .attr("y", 150)
          .attr("text-anchor", "middle")
          .attr("font-size", "18px")
          .attr("fill", "gray")
          .text("No data available for selected major.");
        return;
      }

      svg.selectAll("circle")
        .data(filtered)
        .enter()
        .append("circle")
        .attr("cx", d => d.income / 150)
        .attr("cy", d => 300 - d.debt / 2)
        .attr("r", 10)
        .attr("fill", "darkorange")
        .append("title")
        .text(d => `${d.major}: $${d.debt} debt / $${d.income} income`);
    }

    function populateFilters() {
      const select = d3.select("#majorFilter");
      select.selectAll("option").remove();
      select.append("option").text("All").attr("value", "All");
      allData.forEach(d => {
        select.append("option").text(d.major).attr("value", d.major);
      });
      select.on("change", function () {
        const selected = d3.select(this).property("value");
        renderScene4(selected); // 
      });
    }

    function advanceScene() {
      currentScene++;
      if (currentScene === 1) {
        renderScene0(); // Placeholder for Scene 1
      } else if (currentScene === 2) {
        renderScene0(); // Placeholder for Scene 2
      } else if (currentScene === 3) {
        renderScene0(); // Placeholder for Scene 3
      } else if (currentScene === 4) {
        populateFilters();
        renderScene4();
        d3.select("#next").style("display", "none");
        d3.select("#reset").style("display", "inline-block");
      }
    }

    function resetVisualization() {
      currentScene = 0;
      d3.select("#next").style("display", "inline-block");
      d3.select("#reset").style("display", "none");
      renderScene0();
    }

    document.getElementById("next").addEventListener("click", advanceScene);
    document.getElementById("reset").addEventListener("click", resetVisualization);

    renderScene0();
  </script>
</body>
</html>
